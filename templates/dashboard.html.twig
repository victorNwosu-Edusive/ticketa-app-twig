{% extends "base.html.twig" %}

{% block content %}
{% include 'partials/navbar.twig' %}

<div class="max-w-[1440px] mx-auto px-6 py-10">

  <h1 class="text-xl md:text-2xl font-bold mb-1">
    Welcome, {{ user.name|default("Guest") }}
  </h1>
  <p class="text-gray-500 text-[13px] md:text-[15px] mb-6">Youâ€™re now logged in ðŸŽ‰</p>

  <h1 class="text-2xl md:text-3xl font-bold mb-6">Dashboard</h1>

  {% if error %}
    <div class="mb-4 text-red-600">
      {{ error }}
      <a href="/dashboard" class="ml-4 underline">Retry</a>
    </div>
  {% endif %}

  <div class="grid gap-6 md:grid-cols-4 mb-8">
    <div class="bg-blue-700 rounded-2xl shadow p-10 text-white">
      <p class="text-sm mb-6">Total tickets</p>
      <p class="text-6xl font-semibold">{{ tickets|length }}</p>
    </div>

    <div class="bg-green-100 border border-green-400 rounded-2xl shadow p-10">
      <p class="text-sm mb-6 text-gray-500">Open tickets</p>
      <p class="text-6xl font-semibold">
        {{ tickets|filter(t => t.status == 'open')|length }}
      </p>
    </div>

    <div class="bg-amber-100 border border-amber-400 rounded-2xl shadow p-10">
      <p class="text-sm mb-6 text-gray-500">In Progress tickets</p>
      <p class="text-6xl font-semibold">
        {{ tickets|filter(t => t.status == 'in_progress')|length }}
      </p>
    </div>

    <div class="bg-gray-100 border border-gray-400 rounded-2xl shadow p-10">
      <p class="text-sm mb-6 text-gray-500">Resolved tickets</p>
      <p class="text-6xl font-semibold">
        {{ tickets|filter(t => t.status == 'closed')|length }}
      </p>
    </div>
  </div>

  <div class="border p-4 rounded-md bg-slate-50 shadow">
    <div class="flex items-center justify-between">
      <h2 class="text-sm md:text-xl font-semibold">Ticket Management</h2>
      <div class="flex gap-4">
        <a href="/create-ticket.php" class="text-blue-600 hover:underline text-[12px]">
          + Create â†’
        </a>
        <a href="/tickets.php" class="text-blue-600 hover:underline text-[12px]">
          Go to Tickets â†’
        </a>
      </div>
    </div>

    <div class="mt-4">
      <p class="text-[13px] md:text-[15px] text-gray-600">
        Quick view of the latest tickets:
      </p>

      <ul class="mt-4 space-y-3">
        {% if tickets|length > 0 %}
          {% for t in tickets|slice(0,3) %}
            <li class="p-3 border bg-white rounded-md flex justify-between items-center">
              <div>
                <p class="font-bold text-sm">{{ t.title }}</p>
                <p class="text-[13px] text-gray-500">{{ t.description|slice(0,80) }}</p>
              </div>
              <div class="p-2 rounded-full text-[10px]
                {% if t.status == 'open' %} text-green-800 bg-green-100
                {% elseif t.status == 'in_progress' %} text-amber-800 bg-amber-100
                {% else %} text-gray-700 bg-gray-100 {% endif %}">
                {{ t.status|capitalize }}
              </div>
            </li>
          {% endfor %}
        {% else %}
          <li class="text-gray-500">No tickets yet.</li>
        {% endif %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}
